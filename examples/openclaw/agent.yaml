# Example: OpenClaw AI gateway with Telegram
#
# Run OpenClaw in an isolated container with credential injection.
# The Anthropic API key is injected at the network layer â€” OpenClaw never sees it.
# The Telegram bot token is injected as an env var via the telegram credential provider.
# The gateway token is injected from 1Password via moat secrets.
#
# Prerequisites:
#   1. Anthropic API key granted: moat grant anthropic
#   2. Telegram bot token granted: moat grant telegram
#   3. 1Password CLI signed in: eval $(op signin)
#   4. Gateway token stored in 1Password (see README)
#
# Run with:
#   moat run examples/openclaw

name: openclaw
runtime: docker

volumes:
  - name: state
    target: /home/moatuser/.openclaw

dependencies:
  - node@22
  - git
  - docker:dind

grants:
  - anthropic              # LLM API key (injected at network layer by proxy)
  - telegram               # Telegram bot token (proxy rewrites URL paths)

secrets:
  OPENCLAW_GATEWAY_TOKEN: op://Private/OpenClaw/password

ports:
  gateway: 18789           # OpenClaw Control UI

hooks:
  post_build_root: |
    curl -fsSL --proto '=https' --tlsv1.2 https://openclaw.ai/install.sh | bash -s -- --no-prompt --no-onboard

interactive: true
command: ["node", "/workspace/start.js"]
