---
title: "Audit logs"
description: "Tamper-proof audit logging with cryptographic hash chains."
keywords: ["moat", "audit", "logging", "hash chain", "verification"]
---

# Audit logs

Moat maintains a tamper-proof audit log for each run. The log records credential usage, network requests, console output, and other events in a cryptographically verifiable chain.

## What gets logged

Each run's audit log captures:

| Event type | What's recorded |
|------------|-----------------|
| Console | stdout/stderr output with timestamps |
| Network | HTTP requests through the proxy (method, URL, status, timing) |
| Credential | When credentials are used and for which hosts |
| Secret | When secrets are resolved from external backends |
| SSH | SSH agent operations (key listing, signing) |

Events are appended to the log as they occur. The log is stored in `~/.moat/runs/<run-id>/logs.db` as a SQLite database.

## Hash chain structure

Each audit entry contains:

- **Sequence number** — Monotonically increasing integer
- **Timestamp** — When the event occurred
- **Event type** — Console, Network, Credential, Secret, SSH
- **Data** — Event-specific payload
- **Previous hash** — SHA-256 hash of the previous entry
- **Hash** — SHA-256 hash of this entry (including previous hash)

```
Entry 1: hash = SHA256(seq=1, timestamp, type, data, prev_hash=0)
Entry 2: hash = SHA256(seq=2, timestamp, type, data, prev_hash=Entry1.hash)
Entry 3: hash = SHA256(seq=3, timestamp, type, data, prev_hash=Entry2.hash)
...
```

This chain structure means:

- Any modification to an entry changes its hash
- A changed hash breaks the chain (next entry's `prev_hash` won't match)
- Verification can detect tampering, insertion, or deletion

## Verifying audit logs

Verify a run's audit log:

```bash
$ moat audit run_a1b2c3d4e5f6

Auditing run: run_a1b2c3d4e5f6
===============================================================

Log Integrity
  [ok] Hash chain: 47 entries, no gaps, all hashes valid

Local Signatures
  [ok] 1 attestations, all signatures valid

External Attestations (Sigstore/Rekor)
  - No Rekor proofs found

===============================================================
VERDICT: [ok] INTACT - No tampering detected
```

The verification checks:

1. **Hash chain integrity** — Each entry's `prev_hash` matches the previous entry's hash
2. **Sequence continuity** — No gaps in sequence numbers
3. **Signatures** — Ed25519 attestations are valid

## Exporting proof bundles

Export a proof bundle for offline verification or sharing:

```bash
moat audit run_a1b2c3d4e5f6 --export proof.json
```

The proof bundle contains:

- All audit entries with their hashes
- Signatures and attestations
- Metadata (run ID, timestamps)

Verify an exported bundle:

```bash
$ moat verify-bundle proof.json

Verifying bundle: proof.json
===============================================================

Log Integrity
  [ok] Hash chain: 47 entries, no gaps, all hashes valid

Local Signatures
  [ok] 1 attestations, all signatures valid

===============================================================
VERDICT: [ok] INTACT - No tampering detected
```

Proof bundles are self-contained—verification does not require access to the original run data.

## Signatures and attestations

Audit logs can include cryptographic attestations:

**Local signatures** — Ed25519 signatures over the final hash in the chain, generated by Moat using a per-installation key pair.

**External timestamps** — Integration with Sigstore's Rekor transparency log for third-party timestamping (when available).

Attestations provide:

- Proof that the log existed at a specific time
- Non-repudiation (the signer cannot deny creating the attestation)
- Third-party verification (for Rekor timestamps)

## Viewing audit entries

List entries in a run's audit log:

```bash
$ moat audit run_a1b2c3d4e5f6 --list

SEQ  TIME                  TYPE        SUMMARY
1    2025-01-21T10:23:44Z  Credential  github granted
2    2025-01-21T10:23:45Z  Network     GET api.github.com/user 200
3    2025-01-21T10:23:45Z  Console     {"login": "your-username"...
...
```

Filter by event type:

```bash
moat audit run_a1b2c3d4e5f6 --list --type=credential
moat audit run_a1b2c3d4e5f6 --list --type=network
```

## Storage location

Audit logs are stored per-run:

```
~/.moat/runs/<run-id>/
  logs.db          # SQLite database with audit entries
  metadata.json    # Run metadata
  logs.jsonl       # Container output (separate from audit)
  network.jsonl    # Network requests (human-readable copy)
```

The `logs.db` file contains the authoritative audit log with the hash chain. The `.jsonl` files are human-readable copies for convenience.

## Limitations

**Not a blockchain** — The audit log is a local data structure. It provides tamper detection, not tamper prevention. An attacker with write access to `~/.moat/` could delete or replace the entire database.

**Local trust model** — Signatures are generated by the local Moat installation. They prove the log was created by Moat on this machine, not that the machine itself is trustworthy.

**No distributed consensus** — There is no network of validators. The audit log is as trustworthy as the machine running Moat.

For scenarios requiring stronger guarantees, export proof bundles and store them in external systems (version control, append-only storage, third-party notarization services).

## Related concepts

- [Observability](./04-observability.md) — Logs and traces (the data that gets audited)
- [Credential management](./02-credentials.md) — What triggers credential audit events
