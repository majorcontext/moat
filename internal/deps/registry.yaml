# internal/deps/registry.yaml
# Dependency registry - embedded into binary at compile time

# Runtimes
node:
  description: Node.js runtime
  type: runtime
  default: "20"
  versions: ["18", "20", "22"]

go:
  description: Go programming language
  type: runtime
  default: "1.22"

python:
  description: Python programming language
  type: runtime
  default: "3.11"
  versions: ["3.9", "3.10", "3.11", "3.12"]

rust:
  description: Rust programming language
  type: custom
  default: "stable"

# Package managers / runtimes
bun:
  description: JavaScript runtime and package manager
  type: github-binary
  repo: oven-sh/bun
  asset: "bun-linux-{target}.zip"
  bin: "bun-linux-{target}/bun"
  default: "1.1.38"
  tag-prefix: "bun-v"
  targets:
    amd64: x64
    arm64: aarch64

uv:
  description: Fast Python package manager
  type: github-binary
  repo: astral-sh/uv
  asset: "uv-{target}.tar.gz"
  bin: uv
  default: "0.5.14"
  tag-prefix: none
  requires: [python]
  targets:
    amd64: x86_64-unknown-linux-gnu
    arm64: aarch64-unknown-linux-gnu

# npm packages
typescript:
  description: TypeScript compiler
  type: npm
  package: typescript
  requires: [node]

yarn:
  description: Yarn package manager
  type: custom
  requires: [node]

pnpm:
  description: pnpm package manager
  type: custom
  requires: [node]

claude-code:
  description: Claude Code CLI
  type: custom
  user-install: true

codex-cli:
  description: OpenAI Codex CLI
  type: npm
  package: "@openai/codex"
  requires: [node]

# Build tools (github-binary)
protoc:
  description: Protocol Buffers compiler
  type: github-binary
  repo: protocolbuffers/protobuf
  asset: "protoc-{version}-linux-{arch}.zip"
  bin: bin/protoc
  default: "25.1"
  targets:
    amd64: x86_64
    arm64: aarch_64

sqlc:
  description: SQL compiler for Go
  type: github-binary
  repo: sqlc-dev/sqlc
  asset: "sqlc_{version}_linux_{arch}.tar.gz"
  default: "1.25.0"
  targets:
    amd64: amd64
    arm64: arm64

golangci-lint:
  description: Go linter aggregator
  type: github-binary
  repo: golangci/golangci-lint
  asset: "golangci-lint-{version}-linux-{arch}.tar.gz"
  bin: "golangci-lint-{version}-linux-{arch}/golangci-lint"
  default: "2.8.0"
  targets:
    amd64: amd64
    arm64: arm64

# CLI tools
gh:
  description: GitHub CLI
  type: github-binary
  repo: cli/cli
  asset: "gh_{version}_linux_{arch}.tar.gz"
  bin: "gh_{version}_linux_{arch}/bin/gh"
  default: "2.40.0"
  requires: [git]
  targets:
    amd64: amd64
    arm64: arm64

# Database clients (apt)
psql:
  description: PostgreSQL client
  type: apt
  package: postgresql-client

mysql-client:
  description: MySQL client
  type: apt
  package: mysql-client

# Common tools (apt)
git:
  description: Git version control
  type: apt
  package: git

make:
  description: Build automation tool
  type: apt
  package: make

bats:
  description: Bash Automated Testing System
  type: apt
  package: bats

# Custom installers (complex logic)
playwright:
  description: Browser testing framework
  type: custom
  requires: [node]
  default: "latest"

aws:
  description: AWS CLI
  type: custom
  default: "2"

gcloud:
  description: Google Cloud CLI
  type: custom
  default: "latest"

# Task runners
task:
  description: Task runner / Make alternative
  type: github-binary
  repo: go-task/task
  asset: "task_linux_{arch}.tar.gz"
  bin: task
  default: "3.40.0"
  targets:
    amd64: amd64
    arm64: arm64

# Go development tools
gofumpt:
  description: Stricter gofmt
  type: github-binary
  repo: mvdan/gofumpt
  asset: "gofumpt_v{version}_linux_{arch}"
  bin: "gofumpt_v{version}_linux_{arch}"
  default: "0.9.2"
  requires: [go]
  targets:
    amd64: amd64
    arm64: arm64

govulncheck:
  description: Go vulnerability scanner
  type: go-install
  go-package: golang.org/x/vuln/cmd/govulncheck
  requires: [go]

goreleaser:
  description: Go release automation
  type: github-binary
  repo: goreleaser/goreleaser
  asset: "goreleaser_Linux_{arch}.tar.gz"
  bin: goreleaser
  default: "2.13.3"
  targets:
    amd64: x86_64
    arm64: arm64

air:
  description: Live reload for Go apps
  type: github-binary
  repo: cosmtrek/air
  asset: "air_{version}_linux_{arch}.tar.gz"
  bin: air
  default: "1.52.0"
  requires: [go]
  targets:
    amd64: amd64
    arm64: arm64

mockgen:
  description: Go mock generator
  type: go-install
  go-package: go.uber.org/mock/mockgen
  requires: [go]

buf:
  description: Protocol Buffers tooling
  type: github-binary
  repo: bufbuild/buf
  asset: "buf-Linux-{arch}.tar.gz"
  bin: buf/bin/buf
  default: "1.47.0"
  targets:
    amd64: x86_64
    arm64: aarch64

act:
  description: Run GitHub Actions locally
  type: github-binary
  repo: nektos/act
  asset: "act_Linux_{arch}.tar.gz"
  bin: act
  default: "0.2.70"
  targets:
    amd64: x86_64
    arm64: arm64

# CLI essentials
jq:
  description: JSON processor
  type: apt
  package: jq

# curl is used by E2E tests (TestMCPCredentialInjection_E2E) to verify MCP proxy
curl:
  description: Command-line HTTP client
  type: apt
  package: curl

yq:
  description: YAML processor
  type: github-binary
  repo: mikefarah/yq
  asset: "yq_linux_{arch}.tar.gz"
  bin: "yq_linux_{arch}"
  default: "4.45.4"
  targets:
    amd64: amd64
    arm64: arm64

ripgrep:
  description: Fast grep alternative
  type: github-binary
  repo: BurntSushi/ripgrep
  asset: "ripgrep-{version}-{target}.tar.gz"
  bin: "ripgrep-{version}-{target}/rg"
  command: rg
  default: "14.1.1"
  tag-prefix: none
  targets:
    amd64: x86_64-unknown-linux-musl
    arm64: aarch64-unknown-linux-gnu

fd:
  description: Fast find alternative
  type: github-binary
  repo: sharkdp/fd
  asset: "fd-v{version}-{target}.tar.gz"
  bin: "fd-v{version}-{target}/fd"
  default: "10.2.0"
  targets:
    amd64: x86_64-unknown-linux-musl
    arm64: aarch64-unknown-linux-gnu

bat:
  description: Cat with syntax highlighting
  type: github-binary
  repo: sharkdp/bat
  asset: "bat-v{version}-{target}.tar.gz"
  bin: "bat-v{version}-{target}/bat"
  default: "0.24.0"
  targets:
    amd64: x86_64-unknown-linux-musl
    arm64: aarch64-unknown-linux-gnu

fzf:
  description: Fuzzy finder
  type: github-binary
  repo: junegunn/fzf
  asset: "fzf-{version}-linux_{arch}.tar.gz"
  bin: fzf
  default: "0.56.0"
  targets:
    amd64: amd64
    arm64: arm64

delta:
  description: Better git diff viewer
  type: github-binary
  repo: dandavison/delta
  asset: "delta-{version}-{target}.tar.gz"
  bin: "delta-{version}-{target}/delta"
  default: "0.18.0"
  tag-prefix: none
  targets:
    amd64: x86_64-unknown-linux-musl
    arm64: aarch64-unknown-linux-gnu

lazygit:
  description: Terminal UI for git
  type: github-binary
  repo: jesseduffield/lazygit
  asset: "lazygit_{version}_Linux_{target}.tar.gz"
  bin: lazygit
  default: "0.44.0"
  targets:
    amd64: x86_64
    arm64: arm64

# Node.js dev tools
prettier:
  description: Code formatter
  type: npm
  package: prettier
  requires: [node]

eslint:
  description: JavaScript linter
  type: npm
  package: eslint
  requires: [node]

# Python dev tools (installed via uv)
ruff:
  description: Fast Python linter
  type: uv-tool
  package: ruff
  requires: [uv]

black:
  description: Python formatter
  type: uv-tool
  package: black
  requires: [uv]

mypy:
  description: Python type checker
  type: uv-tool
  package: mypy
  requires: [uv]

pytest:
  description: Python testing framework
  type: uv-tool
  package: pytest
  requires: [uv]

# Database tools
redis-cli:
  description: Redis client
  type: apt
  package: redis-tools

sqlite3:
  description: SQLite client
  type: apt
  package: sqlite3

# Cloud tools
terraform:
  description: Infrastructure as Code
  type: custom
  default: "1.10.0"

kubectl:
  description: Kubernetes CLI
  type: custom
  default: "stable"

helm:
  description: Kubernetes package manager
  type: custom
  default: "3.16.0"

# Service dependencies (databases, caches)
postgres:
  description: PostgreSQL database
  type: service
  default: "17"
  versions: ["15", "16", "17"]
  service:
    image: "postgres"
    ports:
      default: 5432
    env_prefix: POSTGRES
    default_user: postgres
    default_db: postgres
    password_env: POSTGRES_PASSWORD
    db_env: POSTGRES_DB
    readiness_cmd: "pg_isready -h localhost -U postgres"
    url_scheme: "postgresql"
    url_format: "{scheme}://{user}:{password}@{host}:{port}/{db}"

mysql:
  description: MySQL database
  type: service
  default: "8"
  versions: ["8", "9"]
  service:
    image: "mysql"
    ports:
      default: 3306
    env_prefix: MYSQL
    default_user: root
    default_db: moat
    password_env: MYSQL_ROOT_PASSWORD
    db_env: MYSQL_DATABASE
    extra_env:
      MYSQL_DATABASE: "{db}"
    readiness_cmd: "mysqladmin ping -h localhost -u root --password={password}"
    url_scheme: "mysql"
    url_format: "{scheme}://{user}:{password}@{host}:{port}/{db}"

redis:
  description: Redis key-value store
  type: service
  default: "7"
  versions: ["6", "7"]
  service:
    image: "redis"
    ports:
      default: 6379
    env_prefix: REDIS
    password_env: ""
    extra_cmd: ["--requirepass", "{password}"]
    readiness_cmd: "redis-cli -a {password} PING"
    url_scheme: "redis"
    url_format: "{scheme}://:{password}@{host}:{port}"

# Meta dependencies (bundles)
go-extras:
  description: Common Go development tools (gofumpt, govulncheck, goreleaser)
  type: meta
  requires: [gofumpt, govulncheck, goreleaser, golangci-lint]

cli-essentials:
  description: Essential CLI tools (jq, yq, fzf, ripgrep, fd, bat)
  type: meta
  requires: [jq, yq, fzf, ripgrep, fd, bat]

python-dev:
  description: Python development tools (uv, ruff, black, mypy, pytest)
  type: meta
  requires: [uv, ruff, black, mypy, pytest]

node-dev:
  description: Node.js development tools (typescript, prettier, eslint)
  type: meta
  requires: [typescript, prettier, eslint]

k8s:
  description: Kubernetes tools (kubectl, helm)
  type: meta
  requires: [kubectl, helm]

# Container tools
docker:
  description: Docker CLI for container operations (requires host Docker socket)
  type: docker
